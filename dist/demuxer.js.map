{"version":3,"sources":["../lib/demuxer.js"],"names":["module","exports","demuxer","stream","stdout","stderr","header","demux","read","type","readUInt8","payload","readUInt32BE","write","on"],"mappings":"AAAA;;AAEA;;;;;;;AAMAA,OAAOC,OAAP,GAAiB,SAASC,OAAT,CAAiBC,MAAjB,EAAyBC,MAAzB,EAAiCC,MAAjC,EAAyC;AACxD,MAAIC,SAAS,IAAb;;AAEA,WAASC,KAAT,GAAiB;AACf;AACAD,aAASA,UAAUH,OAAOK,IAAP,CAAY,CAAZ,CAAnB;AACA,WAAOF,WAAW,IAAlB,EAAwB;AACtB,YAAMG,OAAOH,OAAOI,SAAP,CAAiB,CAAjB,CAAb;AACA,YAAMC,UAAUR,OAAOK,IAAP,CAAYF,OAAOM,YAAP,CAAoB,CAApB,CAAZ,CAAhB;;AAEA,UAAID,YAAY,IAAhB,EAAsB;AACtB,UAAIF,QAAQ,CAAZ,EAAe;AACbJ,eAAOQ,KAAP,CAAaF,OAAb;AACD,OAFD,MAEO;AACLP,eAAOS,KAAP,CAAaF,OAAb;AACD;AACDL,eAASH,OAAOK,IAAP,CAAY,CAAZ,CAAT;AACD;AACF;;AAEDL,SAAOW,EAAP,CAAU,UAAV,EAAsBP,KAAtB;AACA,SAAOA,KAAP;AACD,CAtBD","file":"demuxer.js","sourcesContent":["'use strict';\n\n/**\n * Taken from the docker-modem project, with a slight change to allow for\n * later \"removeListener\"\n *\n * ...okay, so what does it do?\n */\nmodule.exports = function demuxer(stream, stdout, stderr) {\n  var header = null;\n\n  function demux() {\n    debugger;\n    header = header || stream.read(8);\n    while (header !== null) {\n      const type = header.readUInt8(0);\n      const payload = stream.read(header.readUInt32BE(4));\n\n      if (payload === null) break;\n      if (type == 2) {\n        stderr.write(payload);\n      } else {\n        stdout.write(payload);\n      }\n      header = stream.read(8);\n    }\n  }\n\n  stream.on('readable', demux);\n  return demux;\n}\n\n"]}