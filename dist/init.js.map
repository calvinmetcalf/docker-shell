{"version":3,"sources":["../lib/init.js"],"names":["Bluebird","require","Docker","domain","dockerUtil","module","exports","rawOpts","resolve","reject","options","normalizeOptions","process","env","dockerDomain","create","on","e","connectOptions","run","docker","listContainers","err"],"mappings":"AAAA;;AAEA,MAAMA,WAAWC,QAAQ,UAAR,CAAjB;AACA,MAAMC,SAASD,QAAQ,WAAR,CAAf;AACA,MAAME,SAASF,QAAQ,QAAR,CAAf;AACA,MAAMG,aAAaH,QAAQ,eAAR,CAAnB;;AAEAI,OAAOC,OAAP,GAAiB,UAAUC,OAAV,EAAmB;AAClC,SAAO,IAAIP,QAAJ,CAAa,CAACQ,OAAD,EAAUC,MAAV,KAAqB;AACvC,UAAMC,UAAUN,WAAWO,gBAAX,CAA4BJ,OAA5B,EAAqCK,QAAQC,GAA7C,CAAhB;AACA,UAAMC,eAAeX,OAAOY,MAAP,EAArB;;AAEAD,iBAAaE,EAAb,CAAgB,OAAhB,EAAyBC,KAAK;AAC5BA,QAAEC,cAAF,GAAmBR,OAAnB;AACAD,aAAOQ,CAAP;AACD,KAHD;;AAKAH,iBAAaK,GAAb,CAAiB,MAAM;AACrB,UAAI;AACF,cAAMC,SAAS,IAAIlB,MAAJ,CAAWQ,OAAX,CAAf;;AAEAU,eAAOC,cAAP,CAAsBC,OAAO;AAC3B,cAAIA,GAAJ,EAAS;AACPA,gBAAIJ,cAAJ,GAAqBR,OAArB;AACA,mBAAOD,OAAOa,GAAP,CAAP;AACD;AACDd,kBAAQY,MAAR;AACD,SAND;AAOD,OAVD,CAUE,OAAOH,CAAP,EAAU;AACVA,UAAEC,cAAF,GAAmBR,OAAnB;AACAD,eAAOQ,CAAP;AACD;AACF,KAfD;AAgBD,GAzBM,CAAP;AA0BD,CA3BD","file":"init.js","sourcesContent":["'use strict';\n\nconst Bluebird = require('bluebird');\nconst Docker = require('dockerode');\nconst domain = require('domain');\nconst dockerUtil = require('./docker-util');\n\nmodule.exports = function (rawOpts) {\n  return new Bluebird((resolve, reject) => {\n    const options = dockerUtil.normalizeOptions(rawOpts, process.env);\n    const dockerDomain = domain.create();\n\n    dockerDomain.on('error', e => {\n      e.connectOptions = options;\n      reject(e);\n    });\n\n    dockerDomain.run(() => {\n      try {\n        const docker = new Docker(options);\n\n        docker.listContainers(err => {\n          if (err) {\n            err.connectOptions = options;\n            return reject(err);\n          }\n          resolve(docker);\n        });\n      } catch (e) {\n        e.connectOptions = options;\n        reject(e);\n      }\n    });\n  });\n};\n"]}