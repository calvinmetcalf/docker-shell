{"version":3,"sources":["../lib/init.js"],"names":["rawOpts","resolve","reject","options","normalizeOptions","process","env","dockerDomain","create","on","e","connectOptions","run","docker","listContainers","then","catch","err"],"mappings":";;;;;;kBAKe,UAAUA,OAAV,EAAmB;AAChC,SAAO,uBAAa,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACvC,UAAMC,UAAU,qBAAWC,gBAAX,CAA4BJ,OAA5B,EAAqCK,QAAQC,GAA7C,CAAhB;AACA,UAAMC,eAAe,iBAAOC,MAAP,EAArB;;AAEAD,iBAAaE,EAAb,CAAgB,OAAhB,EAAyBC,KAAK;AAC5BA,QAAEC,cAAF,GAAmBR,OAAnB;AACAD,aAAOQ,CAAP;AACD,KAHD;;AAKAH,iBAAaK,GAAb,CAAiB,MAAM;AACrB,UAAI;AACF,cAAMC,SAAS,+BAAWV,OAAX,CAAf;;AAEAU,eAAOC,cAAP,GACGC,IADH,CACQ,MAAM;AACVd,kBAAQY,MAAR;AACD,SAHH,EAIGG,KAJH,CAIUC,GAAD,IAAS;AACdA,cAAIN,cAAJ,GAAqBR,OAArB;AACAD,iBAAOe,GAAP;AACD,SAPH;AAQD,OAXD,CAWE,OAAOP,CAAP,EAAU;AACVA,UAAEC,cAAF,GAAmBR,OAAnB;AACAD,eAAOQ,CAAP;AACD;AACF,KAhBD;AAiBD,GA1BM,CAAP;AA2BD,C;;AAjCD;;;;AACA;;;;AACA;;;;AACA;;;;;;AA8BC","file":"init.js","sourcesContent":["import Bluebird from 'bluebird';\nimport Docker from 'dockerode-promise';\nimport domain from 'domain';\nimport dockerUtil from './docker-util';\n\nexport default function (rawOpts) {\n  return new Bluebird((resolve, reject) => {\n    const options = dockerUtil.normalizeOptions(rawOpts, process.env);\n    const dockerDomain = domain.create();\n\n    dockerDomain.on('error', e => {\n      e.connectOptions = options;\n      reject(e);\n    });\n\n    dockerDomain.run(() => {\n      try {\n        const docker = new Docker(options);\n\n        docker.listContainers()\n          .then(() => {\n            resolve(docker);\n          })\n          .catch((err) => {\n            err.connectOptions = options;\n            reject(err);\n          });\n      } catch (e) {\n        e.connectOptions = options;\n        reject(e);\n      }\n    });\n  });\n};\n"]}